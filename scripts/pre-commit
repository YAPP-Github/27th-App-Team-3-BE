#!/bin/bash

echo "ğŸ” Running Spotless check before commit..."

# ë³€ê²½ëœ Kotlin íŒŒì¼ë“¤ ì´ë¦„ë§Œ ì¶”ì¶œ í›„ ì €ì¥
stagedFiles=$(git diff --staged --name-only | grep -E '\.kt$|\.kts$')

if [ -z "$stagedFiles" ]; then
    echo "âœ… No Kotlin files to check."
    exit 0
fi

# SpotlessApply ì‹¤í–‰
echo "ğŸ¨ Running spotlessApply. Formatting code..."
./gradlew spotlessApply --daemon

# spotlessApply ì‹¤íŒ¨ ì‹œ ì»¤ë°‹ ì¤‘ë‹¨
if [ $? -ne 0 ]; then
    echo "âŒ Spotless formatting failed. Please fix the errors and try again."
    exit 1
fi

# ë³€ê²½ ì‚¬í•­ì´ ë°œìƒí•œ íŒŒì¼ë“¤ ë‹¤ì‹œ git add
echo "ğŸ“¦ Re-staging formatted files..."
for file in $stagedFiles; do
    if test -f "$file"; then
        git add "$file"
    fi
done

echo "âœ… Spotless check passed!"
exit 0

